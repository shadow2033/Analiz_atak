# Правило UACME_23_DismCore_Hijacking

UACME (User Account Control Me) - это набор утилит, предназначенных для обхода механизма контроля учетных записей пользователей (UAC) в операционной системе Windows. Одним из методов обхода UAC является злоупотребление уязвимостью в DismCore.dll, которая позволяет подменить эту библиотеку внедрением зловредного кода.

## Методы атаки:

1. **Использование уязвимости в COM-объекте с повышенными привилегиями:** Атакующий использует уязвимость, связанную с COM-объектом, имеющим повышенные привилегии, чтобы копировать файлы в защищенные места, такие как C:\Windows\System32. Этот COM-объект вызывает dism.exe, который имеет уязвимость DLL-загрузки.

2. **DLL-загрузка с подменой:** Для обхода UAC, атакующий создает поддельный файл dismCore.dll, который перехватывает вызовы, предназначенные для оригинальной DLL. Приложение, которое выполняет UAC-поднятие, загружает злоумышленную DLL вместо оригинальной, что позволяет атакующему выполнить свой код с повышенными привилегиями.

3. **Манипуляция путем записи файла:** Атакующий создает файл, содержащий путь к целевому приложению, которое нужно выполнить с повышенными привилегиями. Затем, создав поддельный dismCore.dll, злоумышленная DLL считывает путь из этого файла и запускает указанное приложение с повышенными привилегиями. Таким образом, обход UAC выполняется, и целевое приложение запускается с повышенными привилегиями.

## Цель атаки:

Целью атаки является обход механизма контроля учетных записей пользователей (UAC) в Windows, чтобы выполнить злоумышленный код с повышенными привилегиями без предварительного уведомления и разрешения пользователя. Это может позволить атакующему выполнить операции, которые требуют повышенных привилегий, такие как изменение системных файлов и реестра, установка вредоносного программного обеспечения и многие другие действия, угрожающие безопасности системы.

## Описание правила

Правило "UACME_23_DismCore_Hijacking" анализирует события запуска процесса, где родительский процесс - это dism.exe. dism.exe (Deployment Image Service Management Tool) - это утилита в системе Windows, которая используется для управления образами развертывания и компонентами системы.

### Событие "Start_Dism_By_Pkgmgr_Oemsetup"

- **key:** Формируется на основе хоста (event_src.host).
- **filter:**
  - `filter::NotFromCorrelator()`: Исключает события, созданные из коррелятора.
  - `filter::ProcessStart_Windows_any()`: Событие применяется к событиям запуска процессов на платформе Windows.
  - `match(lower(object.process.fullpath), "?:\windows\system32\dism.exe")`: Условие, что запускается процесс dism.exe из каталога C:\Windows\System32.
  - `match(lower(object.process.parent.fullpath), "?:\windows\system32\pkgmgr.exe")`: Условие, что родительский процесс (pkgmgr.exe) также запущен из каталога C:\Windows\System32.
  - `match(lower(object.process.parent.cmdline), "*oemsetup.xml")`: Условие, что командная строка родительского процесса содержит фразу "oemsetup.xml" (похоже, это связано с установкой OEM-компонентов).

### Событие "Start_Process_By_Dism"

- **key:** Формируется на основе хоста (event_src.host).
- **filter:**
  - `filter::NotFromCorrelator()`: Исключает события, созданные из коррелятора.
  - `filter::ProcessStart_Windows_any()`: Событие применяется к событиям запуска процессов на платформе Windows.
  - `match(lower(object.process.parent.fullpath), "?:\windows\system32\dism.exe")`: Условие, что родительский процесс (dism.exe) также запущен из каталога C:\Windows\System32.
