# Правило UAC_Bypass_Via_Consent

Атака "UAC Bypass Via Consent" представляет собой метод обхода механизмов контроля учетных записей пользователя (UAC) в операционной системе Windows с целью повышения привилегий процесса на системе. UAC в Windows позволяет программе повысить свои привилегии до уровня администратора (определяется как уровни целостности от низкого до высокого), возможно, запросив подтверждение пользователя. Воздействие на пользователя варьируется от отказа выполнения операции при высокой степени обеспечения до разрешения пользователю выполнить действие, если он состоит в группе локальных администраторов и пройдет через соответствующий запрос, или если пользователь введет пароль администратора для завершения действия.

## Методы атаки:

- **Использование поддельной библиотеки comctrl32.dll:** Атакующие используют уязвимость, которая позволяет загрузить поддельную библиотеку comctrl32.dll с помощью утилиты consent.exe. Это позволяет запустить зловредный код с повышенными привилегиями.

## Цель атаки:

Основной целью этой атаки является получение повышенных привилегий на системе без предупреждения UAC. Это может дать атакующим полный контроль над системой и позволить им выполнить вредоносные операции.

## Описание правила

Правило "UAC_Bypass_Via_Consent" нацелено на мониторинг запуска и загрузки файлов, связанных с процессом consent.exe в системной директории Windows\System32. Это может быть важным с аспекта безопасности, так как мониторинг этих событий позволяет обнаруживать подозрительную активность, связанную с данным процессом, и может быть полезным для выявления попыток обхода защиты UAC или других потенциальных угроз безопасности.

### Событие "Process_Start":

- **key:** Событие идентифицируется по хосту (event_src.host) и GUID процесса (object.process.guid).
- **filter:**
  - `filter::NotFromCorrelator()`: Исключает события, созданные из коррелятора.
  - `event_src.title == "sysmon"`: Фильтрует события, связанные с Sysmon (системой мониторинга событий).
  - `msgid == "1"`: Ожидает события с определенным идентификатором сообщения (Process Start).
  - `status == "success"`: Фильтрует успешно выполненные процессы.
  - `match(lower(object.process.fullpath), "?:\windows\system32\consent.exe")`: Проверяет, что запущенный процесс находится по указанному пути, который соответствует consent.exe в системной директории Windows\System32.

### Событие "Image_Load":

- **key:** Событие идентифицируется по хосту (event_src.host) и GUID процесса (subject.process.guid).
- **filter:**
  - `filter::NotFromCorrelator()`: Исключает события, созданные из коррелятора.
  - `event_src.title == "sysmon"`: Фильтрует события, связанные с Sysmon.
  - `msgid == "7"`: Ожидает события с определенным идентификатором сообщения (Image Load).
  - `match(lower(subject.process.fullpath), "?:\windows\system32\consent.exe")`: Проверяет, что процесс consent.exe в системной директории запускается.
  - `match(lower(object.process.fullpath), "?:\windows\system32\consent.exe.local\*")`: Проверяет, что процесс consent.exe.local загружает файлы (библиотеки) из директории consent.exe.local в системной директории.
