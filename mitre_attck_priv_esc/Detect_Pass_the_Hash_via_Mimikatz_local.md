# Правило Detect_Pass_the_Hash_via_Mimikatz_local

Атака "Pass-the-Hash" (PtH) - это метод атаки, при котором злоумышленник использует хэши паролей, скомпрометированные на одной системе, для получения доступа к другим системам, не раскрывая фактические пароли. Эта конкретная атака описывает локальное использование инструмента Mimikatz для выполнения атаки Pass-the-Hash на целевой системе.

## Методы атаки:

1. **Сбор хэшей паролей:** Атакующий, который уже имеет доступ к целевой системе, использует Mimikatz для сбора хэшей паролей пользователей, которые были ранее кэшированы на этой системе.

2. **Имперсонация пользователя:** Атакующий может использовать полученные хэши паролей для создания сеанса аутентификации на другой системе вместо предоставления фактического пароля. Это позволяет атакующему маскировать свою идентичность и получить доступ к системе от имени другого пользователя без необходимости знать фактический пароль.

## Цель атаки:

- **Получение несанкционированного доступа:** Основной целью атаки "Pass-the-Hash" является получение несанкционированного доступа к системам и ресурсам, обходя стандартную аутентификацию с использованием фактических паролей пользователей.

- **Установка нарушителя в системе:** Захватив учетные данные, атакующий может выполнить различные вредоносные операции на компьютере, такие как установка вредоносного ПО, сбор конфиденциальных данных и другие действия, направленные на достижение своих целей.

## Описание правила

Правило "Detect_Pass_the_Hash_via_Mimikatz_local" предназначено для мониторинга и обнаружения определенных видов аутентификационных событий в операционной системе Windows, которые могут быть связаны с потенциально подозрительными или нежелательными активностями.

### Событие "PtH_Logon":

- **key:** Ключ формируется на основе хоста (event_src.host) и имени учетной записи пользователя (subject.account.name).

- **filter:**
  - `filter::NotFromCorrelator()`: Это событие исключено из коррелятора.
  - `event_src.title == "windows"`: Фильтрует события, связанные с операционной системой Windows.
  - `msgid == "4624"`: Фильтр, ожидающий события с определенным идентификатором сообщения (4624), что является событием успешной аутентификации.
  - `src.host == "::1"`: Этот фильтр указывает на IP-адрес "::1", который соответствует локальному хосту (localhost). Это может означать, что событие связано с локальной аутентификацией.
  - `logon_type == 9`: Фильтр по типу входа, равному 9.
  - `lower(logon_service) == "seclogo"`: Фильтр, который проверяет, что сервис аутентификации (logon_service) имеет значение "seclogo". Это может указывать на использование определенного сервиса для аутентификации.

### Событие "Special_Logon_NewUser":

- **key:** Ключ формируется на основе хоста (event_src.host) и имени учетной записи пользователя (subject.account.name).

- **filter:**
  - `filter::NotFromCorrelator()`: Это событие исключено из коррелятора.
  - `event_src.title == "windows"`: Фильтрует события, связанные с операционной системой Windows.
  - `msgid == "4672"`: Фильтр, ожидающий события с определенным идентификатором сообщения (4672), что является событием "специальные привилегии, назначенные новому входу" в Windows.
  - `subject.account.name != null`: Фильтр, который проверяет, что имя учетной записи пользователя не является пустым (null).
