# Правило "Remote_registry_access"

Атака "Remote_registry_access" описывает попытки получить доступ к данным учетных записей, хранящимся в локальной базе данных SAM на удаленной системе.

## Методы атаки:

1. **Инъекция в память:** Злоумышленники могут использовать различные инструменты и методы для извлечения данных из SAM базы данных, находящейся в памяти системы.
   - `pwdumpx.exe`: Утилита для извлечения хэшей паролей из SAM базы данных в памяти.
   - `gsecdump`: Инструмент для извлечения информации о паролях из системной памяти.
   - `Mimikatz`: Мощный инструмент для извлечения различных данных, включая хэши паролей, из системной памяти.
   - `secretsdump.py`: Python-инструмент, используемый для извлечения паролей из системной памяти.

2. **Извлечение из Реестра:** Злоумышленники также могут попытаться извлечь базу данных SAM из Windows Registry, используя следующие команды:
   - `perlCopy codereg save HKLM\sam sam`
   - `reg save HKLM\system system`

**Цель атаки:**Целью атаки, направленной на извлечение данных из базы данных SAM или реестра Windows, связана с получением учетных данных и паролей, хранимых на целевой системе.

## Описание правила

Правило "Remote_registry_access" направлено на мониторинг событий доступа к удаленной файловой системе IPC$ и событий особых входов (special logon) на системе.

### Событие Share_Access:

Это событие относится к доступу к общим ресурсам в Windows (Share Access).

- **key:** Ключ события формируется на основе исходного хоста и идентификатора сессии субъекта.
- **filter:** Условия фильтрации:
  - `filter::NotFromCorrelator()`: Событие не должно быть отправлено коррелятором.
  - `event_src.title == "windows"`: Заголовок события должен быть равен "windows".
  - `msgid == "5145"`: Идентификатор сообщения события (msgid) должен быть равен "5145", что, вероятно, соответствует событию доступа к общим ресурсам.
  - `subject == "account"`: Субъект события должен быть типа "account", что указывает на то, что событие связано с аккаунтом пользователя.
  - `action == "access"`: Действие события должно быть равно "access", указывая на попытку доступа.
  - `object == "file_object"`: Объект события должен быть типа "file_object", что указывает на работу с файлами.
  - `lower(object.storage.id) == "*\ipc$"`: Идентификатор хранилища объекта должен быть равен *\ipc$, что указывает на попытку доступа к IPC ресурсу.
  - `lower(object.storage.name) == "winreg"`: Имя должно быть равно "winreg", возможно указывая на попытку доступа к реестру Windows.

### Событие Special_logon:

Это событие связано с "Special Logon" в Windows, обычно связанным с привилегиями.

- **key:** Ключ события формируется на основе исходного хоста и идентификатора сессии субъекта.
- **filter:** Условия фильтрации:
  - `filter::NotFromCorrelator()`: Событие не должно быть отправлено коррелятором.
  - `event_src.title == "windows"`: Заголовок события должен быть равен "windows".
  - `msgid == "4672"`: Идентификатор сообщения события (msgid) должен быть равен "4672".
  - `subject == "account"`: Субъект события должен быть типа "account", что указывает на то, что событие связано с аккаунтом пользователя.
  - `action == "elevate"`: Действие события должно быть равно "elevate", что указывает на повышение привилегий.
  - `object == "account"`: Объект события должен быть типа "account", что указывает на аккаунт пользователя.
  - `find_substr(lower(object.account.privileges), "sebackupprivilege") != null`: Проверяется наличие строки "sebackupprivilege" в списке привилегий учетной записи объекта.
