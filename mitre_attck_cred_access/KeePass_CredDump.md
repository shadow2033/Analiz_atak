# Правило KeePass_CredDump

## Описание

Атака, известная как "KeeFarce," представляет собой метод извлечения информации из базы паролей KeePass 2.x, находящейся в памяти системы. В результате выполнения атаки, информация в чистом виде, включая имена пользователей, пароли, заметки и URL-адреса, собирается в файл CSV и сохраняется в каталоге `%AppData%`.

**Цель атаки:** Цель атаки "KeeFarce" заключается в извлечении конфиденциальной информации из базы паролей KeePass 2.x, находящейся в оперативной памяти системы.

## Методы атаки

Атака "KeePass_CredDump" и "KeeFarce" использует несколько методов и техник для достижения своей цели:

- **DLL-инъекция**: Атака начинается с внедрения специальных DLL (библиотек) в процесс KeePass. Это позволяет злоумышленникам выполнить свой код в контексте процесса KeePass.

- **Исполнение кода на C#**: Злоумышленники используют C# код для выполнения операций извлечения данных из памяти процесса KeePass.

- **Использование CLRMD**: Во время атаки используется библиотека CLR Memory Diagnostics (CLRMD) для поиска и доступа к объектам, содержащим пароли и другую конфиденциальную информацию в куче процесса KeePass.

- **Извлечение данных с использованием отражения**: Злоумышленники используют механизм отражения (reflection) для вызова экспортных методов и извлечения информации из базы паролей.

- **Сохранение информации в CSV файл**: После извлечения данных, информация, включая имена пользователей, пароли, заметки и URL-адреса, сохраняется в формате CSV файла в каталоге `%AppData%`.

## Описание правила

Правило "KeePass_CredDump" используется для обнаружения попыток создания удаленных потоков в процессе `keepass.exe`. Такие попытки могут свидетельствовать о потенциальной атаке, связанной с извлечением данных из KeePass (например, паролей) с использованием инъекций DLL или других методов.

### Событие event CreateRemoteThread:

#### Основные критерии фильтрации:

- `event_src.host`: Ключ для идентификации события по хосту.
- `filter::NotFromCorrelator()`: Проверка на то, что событие не является результатом корреляции.
- `event_src.title == "sysmon"`: Проверка, что событие было сгенерировано системой Sysmon.
- `msgid == "8"`: Проверка, что это событие с кодом 8, что соответствует созданию удаленного потока.
- `lower(object.process.name) == "keepass.exe"`: Проверка, что процесс, в котором создается удаленный поток, имеет имя "keepass.exe".
- `subject.process.name != null`: Проверка, что у субъекта, создавшего удаленный поток, есть имя процесса.
