# Правило  Detect_execution_imageload_wuauclt_lolbas 

Атака "Detect_execution_imageload_wuauclt_lolbas" направлена на использование клиент Центра обновления Windows (wuauclt.exe) для загрузки произвольной динамической библиотеки (DLL). Это поведение используется в качестве техники обхода защиты, чтобы смешать вредоносную активность с легитимным программным обеспечением Windows.

## Методы атаки:

1. **Использование wuauclt.exe:** Злоумышленники могут использовать клиент Центра обновления Windows (wuauclt.exe), который является легитимным процессом в Windows, для выполнения своих вредоносных действий.

2. **Загрузка произвольной DLL:** Злоумышленники пытаются загрузить произвольную динамическую библиотеку (DLL) с целью выполнения кода, который может быть вредоносным или использоваться для обхода средств обнаружения и защиты.

3. **Обход защиты:** Злоумышленники используют эту технику для обхода обнаружения и защиты, так как wuauclt.exe является легитимным процессом и его использование может скрыть зловредную активность.

**Цель атаки:** Целью данной атаки является обеспечение злоумышленникам возможности выполнения своего вредоносного кода на системе, минуя средства обнаружения и блокировки. Загрузка произвольной DLL через wuauclt.exe позволяет им скрыть свои следы и обмануть средства безопасности, используя легитимный процесс Windows для своих целей.

## Описание правила

Правило "Detect_execution_imageload_wuauclt_lolbas" анализирует действия, связанные с процессом "wuauclt.exe" (клиент Центра обновления Windows) и его потенциальной связи с загрузкой и использованием DLL-файлов. Правило "Image_Load" отслеживает загрузку (DLL) из определенных директорий, а правило "Process_Creation" ищет команды запуска процесса "wuauclt.exe" с указанными аргументами командной строки, связанными с загрузкой DLL.

### Событие "Image_Load":

Это правило отслеживает событие загрузки изображения (DLL или исполняемого файла) на хосте.

- **Key:** event_src.host: Хост, с которого произошло событие.
- **Filter:**
  - `filter::NotFromCorrelator()`: Этот фильтр исключает события, созданные из коррелятора.
  - `event_src.title == "sysmon"`: Ограничение событий только с заголовком "sysmon".
  - `msgid == "7"`: События с идентификатором 7 (Image Load) анализируются.
  - `subject.process.name == "wuauclt.exe"`: Фильтрация событий, связанных с процессом wuauclt.exe (клиент Центра обновления Windows).

- **Фильтры по путям к файлам:**
  - `regex(lower(object.process.path), "\w:\users.*", 0) != null`: Проверяется, что путь к файлу находится в директории пользовательских профилей.
  - `regex(lower(object.process.path), "\w:\programdata.*", 0) != null`: Проверяется, что путь к файлу находится в директории ProgramData.
  - `regex(lower(object.process.path), "\w:\windows\temp.*", 0) != null`: Проверяется, что путь к файлу находится в директории временных файлов Windows.
  - `regex(lower(object.process.path), "\w:\windows\tasks.*", 0) != null`: Проверяется, что путь к файлу находится в директории задач Windows.
  - `match(lower(object.process.name), ".dll") or match(lower(object.process.original_name), ".dll")`: Фильтр наличия ".dll" в имени процесса или оригинальном имени процесса.

### Событие "Process_Creation":

Это правило отслеживает событие создания процесса.

- **Key:** event_src.host: Хост, с которого произошло событие.
- **Filter:**
  - `filter::NotFromCorrelator()`: Этот фильтр исключает события, созданные из коррелятора.
  - `event_src.title == "sysmon"`: Ограничение событий только с заголовком "sysmon".
  - `msgid == "1"`: События с идентификатором 1 (Process Create) анализируются.
  - `match(object.process.parent.name, "wuauclt")`: Фильтрация процессов, у которых имя родительского процесса содержит "wuauclt".
  - `find_substr(lower(object.process.parent.cmdline), "wuauclt") != null`: Проверяется наличие "wuauclt" в командной строке родительского процесса.
  - `find_substr(lower(object.process.parent.cmdline), "updatedeploymentprovider") != null`: Проверяется наличие "updatedeploymentprovider" в командной строке родительского процесса.
  - `find_substr(lower(object.process.parent.cmdline), ".dll") != null`: Проверяется наличие ".dll" в командной строке родительского процесса.
  - `find_substr(lower(object.process.parent.cmdline), "runhandlercomserver") != null`: Проверяется наличие "runhandlercomserver" в командной строке родительского процесса.
