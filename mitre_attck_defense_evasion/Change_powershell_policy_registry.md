# Правило Change_powershell_policy_registry

Атака "Change_powershell_policy_registry" предполагает изменение параметров настройки политик PowerShell, хранящихся в реестре операционной системы Windows.

## Методы атаки:

Злоумышленники могут воспользоваться командами PowerShell для внесения изменений в реестр системы, что позволит им изменять настройки политик PowerShell. Это может включать в себя изменение ключей и значений реестра, связанных с политиками PowerShell. После чего злоумышленники могут попытаться обойти ограничения и выполнить вредоносные скрипты.

**Цель атаки**:Атака направлена на изменение параметров настройки политик PowerShell, хранящихся в реестре операционной системы Windows.

## Описание правила

Правило "Change_powershell_policy_registry" представляет собой правило обнаружения изменения политики выполнения PowerShell-скриптов в Windows или Sysmon-событий, связанных с изменением этой политики.

### Событие "Change_exec_policy":

- **key:** Ключ события формируется на основе исходного хоста, на котором происходит событие.

- **filter:** Условия фильтрации:
  - `filter::NotFromCorrelator()`: Исключает события, созданные коррелятором.
  - `msgid == "13" and event_src.title == "sysmon"`: Фильтры относятся к событиям с msgid равным "13" и событиям, сгенерированным Sysmon.
  - `msgid == "4657" and event_src.title == "windows"`: Фильтры относятся к событиям с msgid равным "4657" и событиям, созданным Windows. (Эти события обычно связаны с аудитом изменений объектов в системе)
  - `match(lower(object.fullpath), "*\shellids\microsoft.powershell\executionpolicy")`: Проверяет, соответствует ли поле "object.fullpath" определенному пути в реестре, который связан с политикой выполнения PowerShell.
  - `in_list(["bypass", "unrestricted", "remotesigned"], lower(object.new_value))`: Проверяет, является ли новое значение ("object.new_value") для рассматриваемой политики выполнения PowerShell одним из указанных вариантов: "bypass", "unrestricted" или "remotesigned". Эти значения связаны с различными уровнями безопасности выполнения сценариев PowerShell.
