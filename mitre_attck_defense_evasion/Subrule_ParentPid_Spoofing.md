# Правило Parent PID Spoofing

Атака Parent PID Spoofing заключается в подделке идентификатора родительского процесса (PPID) для нового процесса с целью обойти мониторинг процессов и/или повысить привилегии. Обычно новые процессы создаются прямо из своего родительского процесса (PPID), если это не указано явно. Одним из способов явного назначения PPID новому процессу является использование API-вызова CreateProcess, который поддерживает параметр для определения PPID, который следует использовать.

## Методы атаки:

1. **Обход мониторинга процессов:** Атакующие могут использовать эту технику, чтобы обойти системы мониторинга процессов, которые рассчитывают на правильные отношения между родительскими и дочерними процессами. Например, процессы, запущенные из документов Office, обычно создаются с PPID, соответствующим Office-продукту. Подделка PPID может позволить атакующим обойти обнаружение таких процессов.

2. **Повышение привилегий:** Атакующие могут также использовать подделку PPID для повышения привилегий. Например, если атакующий работает с привилегированным пользовательским контекстом (например, администратором), они могут создать новый процесс и назначить его родительским процессом другой процесс, который работает с системными привилегиями. Это может привести к повышению привилегий нового процесса.

## Цель атаки:

- Обойти мониторинг процессов и избежать обнаружения при выполнении зловредных действий.
- Повысить привилегии новых процессов, путем назначения родительского процесса с более высокими привилегиями.

## Описание правила

Правило "Subrule_ParentPid_Spoofing" отслеживает события доступа к процессам на основе событий, сгенерированных системой мониторинга Sysmon. В данном случае, событие AccessProcess формирует ключ на основе нескольких параметров, таких как хост, идентификатор процесса (PID) и полный путь к процессу.

### Событие AccessProcess:

- **key:** Формируется на основе следующих параметров: хост, на котором произошло событие (`event_src.host`), идентификатор (PID) процесса (`subject.process.id`) и полный путь к исполняемому файлу процесса (`subject.process.fullpath`).
- **filter:** Условия фильтрации:
  - `filter::NotFromCorrelator()`: Этот фильтр исключает события из коррелятора.
  - `msgid == "10"`: Событие фильтруется по идентификатору "10".
  - `event_src.title == "sysmon"`: События фильтруются только для событий, у которых заголовок равен "sysmon".
  - `in_list(["0x1fffff", "0x1f3fff"], object.value)`: События проходят фильтр, если значение объекта (`object.value`) находится в списке `["0x1fffff", "0x1f3fff"]`. Это фильтр, который выбирает события, где значение, связанное с доступом к процессу, соответствует одному из указанных значений.
